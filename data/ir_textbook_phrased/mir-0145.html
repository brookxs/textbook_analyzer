8.5.2 knuth-morris-pratt the kmp algorithm was the first with linear worst-case-behavior , although on average it is not much faster than bf . this algorithm also slides a window over the text , however , it does not try all window positions as bf does . instead , it reuses information from previous checks . after the window is checked , whether it matched the pattern or not , a number of pattern letters were compared to the text window , and they all matched except possibly the last one compared . hence , when the window has to be shifted , there is a prefix of the pattern that matched the text . the algorithm takes advantage of this information to avoid trying window positions which can be deduced not to match . the pattern is preprocessed in o (m) time and space to build a table called next the next table at position j says which is the longest proper prefix of pi..j-i which is also a suffix and the characters following prefix and suffix are different . hence j ó next [j] ¶ +1 window positions can be safely skipped if the characters up to j ó 1 matched , and the j-th did not . for instance , when searching the word ` abracadabra / if a text window matched up to ` abracab , ' five positions can be safely skipped since next [7] = 1 . figure 8.14 shows an example . the crucial observation is that this information depends only on the pattern , because if the text in the window matched up to position j ó 1 , then that text is equal to the pattern . the algorithm moves a window over the text and a pointer inside the window . each time a character matches , the pointer is advanced (a match is reported if the pointer reaches the end of the window) . each time a character is not matched , the window is shifted forward in the text , to the position given by next but the pointer position in the text does not change . since at each text-comparison the window or the pointer advance by at least one position , the algorithm performs at most 2n comparisons (and at least n) . the aho-corasick algorithm can be regarded as an extension of kmp in matching a set of patterns . the patterns are arranged in a trie-like data-structure . each trie node represents having matched a prefix of some pattern (s) . the next function is replaced by a more general set of failure transitions . those transitions go between nodes of the trie . a transition leaving from a node representing the prefix x leads to a node representing a prefix t / , such that y is the longest prefix in the set of patterns which is also a proper suffix of x. figure 8.15 illustrates this . sequential-searching 211 next = 000010100004 , , a b r a c a d) a b r (a a b r a c a d ibracadabr figure 8.14 kmp algorithm searching ` abracadabra . ' on the left , an illustration of the next function . notice that after matching ` abracada ' we do not try to match the last ` a ' with the first one since what follows can not be a ` b. ' on the right , a search example . grayed areas show the prefix information reused . figure 8.15 aho-corasick trie example for the set ` hello , ' ` elbow ' and ` eleven ' showing only one of all the failure transitions . this trie , together with its failure transitions , is built in o (m) time and space (where m is the total length of all the patterns) . its search-time is o {n) no matter how many patterns are searched . much as kmp , it makes at most 2n inspections .