<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<html>
 <head> 
  <title>Estimating the query generation probability</title> 
  <meta name="description" content="Estimating the query generation probability" /> 
  <meta name="keywords" content="irbook" /> 
  <meta name="resource-type" content="document" /> 
  <meta name="distribution" content="global" /> 
  <meta name="Generator" content="LaTeX2HTML v2002-2-1" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <link rel="STYLESHEET" href="irbook.css" /> 
  <link rel="next" href="ponte-and-crofts-experiments-1.html" /> 
  <link rel="previous" href="using-query-likelihood-language-models-in-ir-1.html" /> 
  <link rel="up" href="the-query-likelihood-model-1.html" /> 
  <link rel="next" href="ponte-and-crofts-experiments-1.html" /> 
 </head> 
 <body> 
  <!--Navigation Panel--> 
  <a name="tex2html3342" href="ponte-and-crofts-experiments-1.html"> <img width="37" height="24" align="BOTTOM" border="0" alt="next" src="http://nlp.stanford.edu/IR-book/html/icons/next.png" /></a> 
  <a name="tex2html3336" href="the-query-likelihood-model-1.html"> <img width="26" height="24" align="BOTTOM" border="0" alt="up" src="http://nlp.stanford.edu/IR-book/html/icons/up.png" /></a> 
  <a name="tex2html3330" href="using-query-likelihood-language-models-in-ir-1.html"> <img width="63" height="24" align="BOTTOM" border="0" alt="previous" src="http://nlp.stanford.edu/IR-book/html/icons/prev.png" /></a> 
  <a name="tex2html3338" href="contents-1.html"> <img width="65" height="24" align="BOTTOM" border="0" alt="contents" src="http://nlp.stanford.edu/IR-book/html/icons/contents.png" /></a> 
  <a name="tex2html3340" href="index-1.html"> <img width="43" height="24" align="BOTTOM" border="0" alt="index" src="http://nlp.stanford.edu/IR-book/html/icons/index.png" /></a> 
  <br /> 
  <b> Next:</b> 
  <a name="tex2html3343" href="ponte-and-crofts-experiments-1.html">Ponte and Croft's Experiments</a> 
  <b> Up:</b> 
  <a name="tex2html3337" href="the-query-likelihood-model-1.html">The query likelihood model</a> 
  <b> Previous:</b> 
  <a name="tex2html3331" href="using-query-likelihood-language-models-in-ir-1.html">Using query likelihood language</a> &nbsp; 
  <b> <a name="tex2html3339" href="contents-1.html">Contents</a></b> &nbsp; 
  <b> <a name="tex2html3341" href="index-1.html">Index</a></b> 
  <br /> 
  <br /> 
  <!--End of Navigation Panel--> 
  <h2><a name="SECTION001722000000000000000"></a><a name="sec:querygeneration"></a> <a name="p:querygeneration"></a> <a name="sec:prob-smoothing"></a> <a name="p:prob-smoothing"></a> <br /> Estimating the query generation probability </h2> 
  <p> In this section we describe how to estimate <img width="64" height="33" align="MIDDLE" border="0" src="img790.png" alt="$P(q\vert M_d)$" />. The probability of producing the query given the LM <img width="27" height="32" align="MIDDLE" border="0" src="img789.png" alt="$M_d$" /> of document <img width="12" height="31" align="MIDDLE" border="0" src="img354.png" alt="$d$" /> using <a name="15362"></a> <i>maximum likelihood estimation</i> (<a name="15364"></a> <i>MLE</i> ) and the unigram assumption is: <br /> </p> 
  <div align="RIGHT"> 
   <!-- MATH
 \begin{equation}
\hat{P}(q|M_d) = \prod_{t \in q} \hat{P}_{mle}(t|M_d) =
\prod_{t \in q} \frac{\termf_{t,d}}{L_d}
\end{equation}
 --> 
   <table width="100%" align="CENTER"> 
    <tbody> 
     <tr valign="MIDDLE"> 
      <td align="CENTER" nowrap=""><a name="p:multinomialestimate"></a><a name="eqn:multinomialestimate"></a><img width="275" height="53" border="0" src="img820.png" alt="\begin{displaymath}\hat{P}(q\vert M_d) = \prod_{t \in q} \hat{P}_{mle}(t\vert M_d) =
\prod_{t \in q} \frac{\termf_{t,d}}{L_d}
\end{displaymath}" /></td> 
      <td width="10" align="RIGHT"> (100)</td> 
     </tr> 
    </tbody> 
   </table> 
   <br clear="ALL" /> 
  </div> 
  <p></p> where 
  <img width="27" height="32" align="MIDDLE" border="0" src="img789.png" alt="$M_d$" /> is the language model of document 
  <img width="12" height="31" align="MIDDLE" border="0" src="img354.png" alt="$d$" />, 
  <img width="29" height="31" align="MIDDLE" border="0" src="img821.png" alt="$\termf_{t,d}$" /> is the (raw) term frequency of term 
  <img width="10" height="32" align="MIDDLE" border="0" src="img67.png" alt="$t$" /> in document 
  <img width="12" height="31" align="MIDDLE" border="0" src="img354.png" alt="$d$" />, and 
  <img width="21" height="32" align="MIDDLE" border="0" src="img773.png" alt="$L_d$" /> is the number of tokens in document 
  <img width="12" height="31" align="MIDDLE" border="0" src="img354.png" alt="$d$" />. That is, we just count up how often each word occurred, and divide through by the total number of words in the document 
  <img width="12" height="31" align="MIDDLE" border="0" src="img354.png" alt="$d$" />. This is the same method of calculating an MLE as we saw in Section&nbsp; 
  <a href="probability-estimates-in-theory-1.html#sec:probtheory">11.3.2</a> (page&nbsp; 
  <a href="probability-estimates-in-theory-1.html#p:probtheory"><img align="BOTTOM" border="1" alt="[*]" src="http://nlp.stanford.edu/IR-book/html/icons/crossref.png" /></a>), but now using a multinomial over word counts. 
  <p> <a name="p:nullproblem"></a> The classic problem with using language models is one of estimation (the 
   <!-- MATH
 $\hat{\phantom{x}}$
 --> <img width="12" height="32" align="MIDDLE" border="0" src="img822.png" alt="$\hat{\phantom{x}}$" /> symbol on the P's is used above to stress that the model is estimated): terms appear very <a name="15382"></a> <i>sparsely</i> in documents. In particular, some words will not have appeared in the document at all, but are possible words for the information need, which the user may have used in the query. If we estimate 
   <!-- MATH
 $\hat{P}(t|M_d) = 0$
 --> <img width="92" height="38" align="MIDDLE" border="0" src="img823.png" alt="$\hat{P}(t\vert M_d) = 0$" /> for a term missing from a document <img width="12" height="31" align="MIDDLE" border="0" src="img354.png" alt="$d$" />, then we get a strict conjunctive semantics: documents will only give a query non-zero probability if all of the query terms appear in the document. Zero probabilities are clearly a problem in other uses of language models, such as when predicting the next word in a speech recognition application, because many words will be sparsely represented in the training data. It may seem rather less clear whether this is problematic in an IR application. This could be thought of as a human-computer interface issue: vector space systems have generally preferred more lenient matching, though recent web search developments have tended more in the direction of doing searches with such conjunctive semantics. Regardless of the approach here, there is a more general problem of estimation: occurring words are also badly estimated; in particular, the probability of words occurring once in the document is normally overestimated, since their one occurrence was partly by chance. The answer to this (as we saw in probtheory) is smoothing. But as people have come to understand the LM approach better, it has become apparent that the role of smoothing in this model is not only to avoid zero probabilities. The smoothing of terms actually implements major parts of the term weighting component (Exercise <a href="ponte-and-crofts-experiments-1.html#ex:smoothing-as-icf">12.2.3</a> ). It is not just that an unsmoothed model has conjunctive semantics; an unsmoothed model works badly because it lacks parts of the term weighting component. </p> 
  <p> <a name="p:probnormaldef"></a> Thus, we need to smooth probabilities in our document language models: to discount non-zero probabilities and to give some probability mass to unseen words. There's a wide space of approaches to smoothing probability distributions to deal with this problem. In Section&nbsp;<a href="probability-estimates-in-theory-1.html#sec:probtheory">11.3.2</a> (page&nbsp;<a href="probability-estimates-in-theory-1.html#p:probtheory"><img align="BOTTOM" border="1" alt="[*]" src="http://nlp.stanford.edu/IR-book/html/icons/crossref.png" /></a>), we already discussed adding a number (1, 1/2, or a small <img width="12" height="32" align="MIDDLE" border="0" src="img524.png" alt="$\alpha$" />) to the observed counts and renormalizing to give a probability distribution.<a name="tex2html118" href="footnode.html#foot15599"><sup><img align="BOTTOM" border="1" alt="[*]" src="http://nlp.stanford.edu/IR-book/html/icons/footnote.png" /></sup></a>In this section we will mention a couple of other smoothing methods, which involve combining observed counts with a more general reference probability distribution. The general approach is that a non-occurring term should be possible in a query, but its probability should be somewhat close to but no more likely than would be expected by chance from the whole collection. That is, if 
   <!-- MATH
 $\termf_{t,d} = 0$
 --> <img width="59" height="31" align="MIDDLE" border="0" src="img824.png" alt="$\termf_{t,d} = 0$" /> then <br /> </p> 
  <div align="RIGHT"> 
   <!-- MATH
 \begin{equation}
\hat{P}(t|M_d) \le \collf_t/T
\end{equation}
 --> 
   <table width="100%" align="CENTER"> 
    <tbody> 
     <tr valign="MIDDLE"> 
      <td align="CENTER" nowrap=""><img width="118" height="28" border="0" src="img825.png" alt="\begin{displaymath}
\hat{P}(t\vert M_d) \le \collf_t/T
\end{displaymath}" /></td> 
      <td width="10" align="RIGHT"> (101)</td> 
     </tr> 
    </tbody> 
   </table> 
   <br clear="ALL" /> 
  </div> 
  <p></p> where 
  <img width="21" height="31" align="MIDDLE" border="0" src="img826.png" alt="$\collf_t$" /> is the raw count of the term in the collection, and 
  <img width="15" height="32" align="MIDDLE" border="0" src="img123.png" alt="$T$" /> is the raw size (number of tokens) of the entire collection. A simple idea that works well in practice is to use a mixture between a document-specific multinomial distribution and a multinomial distribution estimated from the entire collection: 
  <br /> 
  <div align="RIGHT"> 
   <!-- MATH
 \begin{equation}
\hat{P}(t|d) = \lambda \hat{P}_{mle}(t|M_d) + (1 - \lambda)
\hat{P}_{mle}(t|M_c)
\end{equation}
 --> 
   <table width="100%" align="CENTER"> 
    <tbody> 
     <tr valign="MIDDLE"> 
      <td align="CENTER" nowrap=""><a name="p:lgmodelmix"></a><a name="eqn:lgmodelmix"></a><img width="294" height="49" border="0" src="img827.png" alt="\begin{displaymath}\hat{P}(t\vert d) = \lambda \hat{P}_{mle}(t\vert M_d) + (1 - \lambda)
\hat{P}_{mle}(t\vert M_c)
\end{displaymath}" /></td> 
      <td width="10" align="RIGHT"> (102)</td> 
     </tr> 
    </tbody> 
   </table> 
   <br clear="ALL" /> 
  </div> 
  <p></p> where 
  <!-- MATH
 $0 < \lambda < 1$
 --> 
  <img width="74" height="31" align="MIDDLE" border="0" src="img828.png" alt="$0 &lt; \lambda &lt; 1$" /> and 
  <img width="26" height="32" align="MIDDLE" border="0" src="img829.png" alt="$M_c$" /> is a language model built from the entire document collection. This mixes the probability from the document with the general collection frequency of the word. Such a model is referred to as a 
  <a name="15405"></a> 
  <i>linear interpolation</i> language model. 
  <a name="tex2html119" href="footnode.html#foot15407"><sup><img align="BOTTOM" border="1" alt="[*]" src="http://nlp.stanford.edu/IR-book/html/icons/footnote.png" /></sup></a>Correctly setting 
  <img width="14" height="31" align="MIDDLE" border="0" src="img830.png" alt="$\lambda$" /> is important to the good performance of this model. 
  <p> An alternative is to use a language model built from the whole collection as a prior distribution in a <a name="15408"></a> <i>Bayesian updating process</i> (rather than a uniform distribution, as we saw in Section <a href="probability-estimates-in-theory-1.html#sec:probtheory">11.3.2</a> ). We then get the following equation: <br /> </p> 
  <div align="RIGHT"> 
   <!-- MATH
 \begin{equation}
\hat{P}(t|d) = \frac{\termf_{t,d} + \alpha \hat{P}(t|M_c)}{L_d + \alpha}
\end{equation}
 --> 
   <table width="100%" align="CENTER"> 
    <tbody> 
     <tr valign="MIDDLE"> 
      <td align="CENTER" nowrap=""><img width="177" height="46" border="0" src="img831.png" alt="\begin{displaymath}
\hat{P}(t\vert d) = \frac{\termf_{t,d} + \alpha \hat{P}(t\vert M_c)}{L_d + \alpha}
\end{displaymath}" /></td> 
      <td width="10" align="RIGHT"> (103)</td> 
     </tr> 
    </tbody> 
   </table> 
   <br clear="ALL" /> 
  </div> 
  <p></p> 
  <p> Both of these smoothing methods have been shown to perform well in IR experiments; we will stick with the linear interpolation smoothing method for the rest of this section. While different in detail, they are both conceptually similar: in both cases the probability estimate for a word present in the document combines a discounted MLE and a fraction of the estimate of its prevalence in the whole collection, while for words not present in a document, the estimate is just a fraction of the estimate of the prevalence of the word in the whole collection. </p> 
  <p> The role of smoothing in LMs for IR is not simply or principally to avoid estimation problems. This was not clear when the models were first proposed, but it is now understood that smoothing is essential to the good properties of the models. The reason for this is explored in Exercise <a href="ponte-and-crofts-experiments-1.html#ex:smoothing-as-icf">12.2.3</a> . The extent of smoothing in these two models is controlled by the <img width="14" height="31" align="MIDDLE" border="0" src="img830.png" alt="$\lambda$" /> and <img width="12" height="32" align="MIDDLE" border="0" src="img524.png" alt="$\alpha$" /> parameters: a small value of <img width="14" height="31" align="MIDDLE" border="0" src="img830.png" alt="$\lambda$" /> or a large value of <img width="12" height="32" align="MIDDLE" border="0" src="img524.png" alt="$\alpha$" /> means more smoothing. This parameter can be tuned to optimize performance using a line search (or, for the linear interpolation model, by other methods, such as the expectation maximimization algorithm; see modelclustering). The value need not be a constant. One approach is to make the value a function of the query size. This is useful because a small amount of smoothing (a ``conjunctive-like'' search) is more suitable for short queries, while a lot of smoothing is more suitable for long queries. </p> 
  <p> To summarize, the retrieval ranking for a query <img width="12" height="32" align="MIDDLE" border="0" src="img161.png" alt="$q$" /> under the basic LM for IR we have been considering is given by: <br /> </p> 
  <div align="RIGHT"> 
   <!-- MATH
 \begin{equation}
P(d|q) \propto P(d)\prod_{t \in q} ((1-\lambda)P(t|M_c) + \lambda
P(t|M_d))
\end{equation}
 --> 
   <table width="100%" align="CENTER"> 
    <tbody> 
     <tr valign="MIDDLE"> 
      <td align="CENTER" nowrap=""><a name="eqn:multinomialformula"></a><a name="p:multinomialformula"></a><img width="327" height="45" border="0" src="img832.png" alt="\begin{displaymath}
P(d\vert q) \propto P(d)\prod_{t \in q} ((1-\lambda)P(t\vert M_c) + \lambda
P(t\vert M_d))\end{displaymath}" /></td> 
      <td width="10" align="RIGHT"> (104)</td> 
     </tr> 
    </tbody> 
   </table> 
   <br clear="ALL" /> 
  </div> 
  <p></p> This equation captures the probability that the document that the user had in mind was in fact 
  <img width="12" height="31" align="MIDDLE" border="0" src="img354.png" alt="$d$" />. 
  <p> <b>Worked example.</b> Suppose the document collection contains two documents: </p> 
  <ul> 
   <li><img width="19" height="31" align="MIDDLE" border="0" src="img412.png" alt="$d_1$" />: Xyzzy reports a profit but revenue is down </li> 
   <li><img width="19" height="31" align="MIDDLE" border="0" src="img413.png" alt="$d_2$" />: Quorus narrows quarter loss but revenue decreases further </li> 
  </ul> The model will be MLE unigram models from the documents and collection, mixed with 
  <img width="62" height="31" align="MIDDLE" border="0" src="img833.png" alt="$\lambda = 1/2$" />. 
  <p> Suppose the query is <i>revenue down</i>. Then: <br /> </p> 
  <div align="CENTER"> 
   <!-- MATH
 \begin{eqnarray}
P(q|d_1) &=& [(1/8 + 2/16)/2]\times [(1/8 + 1/16)/2] \\
             &=& 1/8 \times 3/32 = 3/256  \\
P(q|d_2) &=& [(1/8 + 2/16)/2] \times [(0/8 + 1/16)/2]   \\
            &=& 1/8 \times 1/32 = 1/256
\end{eqnarray}
 --> 
   <table align="CENTER" cellpadding="0" width="100%"> 
    <tbody> 
     <tr valign="MIDDLE"> 
      <td nowrap="" align="RIGHT"><img width="56" height="33" align="MIDDLE" border="0" src="img834.png" alt="$\displaystyle P(q\vert d_1)$" /></td> 
      <td align="CENTER" nowrap=""><img width="17" height="32" align="MIDDLE" border="0" src="img313.png" alt="$\textstyle =$" /></td> 
      <td align="LEFT" nowrap=""><img width="265" height="33" align="MIDDLE" border="0" src="img835.png" alt="$\displaystyle [(1/8 + 2/16)/2]\times [(1/8 + 1/16)/2]$" /></td> 
      <td width="10" align="RIGHT"> (105)</td> 
     </tr> 
     <tr valign="MIDDLE"> 
      <td nowrap="" align="RIGHT">&nbsp;</td> 
      <td align="CENTER" nowrap=""><img width="17" height="32" align="MIDDLE" border="0" src="img313.png" alt="$\textstyle =$" /></td> 
      <td align="LEFT" nowrap=""><img width="147" height="31" align="MIDDLE" border="0" src="img836.png" alt="$\displaystyle 1/8 \times 3/32 = 3/256$" /></td> 
      <td width="10" align="RIGHT"> (106)</td> 
     </tr> 
     <tr valign="MIDDLE"> 
      <td nowrap="" align="RIGHT"><img width="56" height="33" align="MIDDLE" border="0" src="img837.png" alt="$\displaystyle P(q\vert d_2)$" /></td> 
      <td align="CENTER" nowrap=""><img width="17" height="32" align="MIDDLE" border="0" src="img313.png" alt="$\textstyle =$" /></td> 
      <td align="LEFT" nowrap=""><img width="265" height="33" align="MIDDLE" border="0" src="img838.png" alt="$\displaystyle [(1/8 + 2/16)/2] \times [(0/8 + 1/16)/2]$" /></td> 
      <td width="10" align="RIGHT"> (107)</td> 
     </tr> 
     <tr valign="MIDDLE"> 
      <td nowrap="" align="RIGHT">&nbsp;</td> 
      <td align="CENTER" nowrap=""><img width="17" height="32" align="MIDDLE" border="0" src="img313.png" alt="$\textstyle =$" /></td> 
      <td align="LEFT" nowrap=""><img width="147" height="31" align="MIDDLE" border="0" src="img839.png" alt="$\displaystyle 1/8 \times 1/32 = 1/256$" /></td> 
      <td width="10" align="RIGHT"> (108)</td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <br clear="ALL" /> 
  <p></p> So, the ranking is 
  <img width="56" height="31" align="MIDDLE" border="0" src="img840.png" alt="$d_1 &gt; d_2$" />. 
  <b>End worked example.</b> 
  <p> </p> 
  <hr /> 
  <!--Navigation Panel--> 
  <a name="tex2html3342" href="ponte-and-crofts-experiments-1.html"> <img width="37" height="24" align="BOTTOM" border="0" alt="next" src="http://nlp.stanford.edu/IR-book/html/icons/next.png" /></a> 
  <a name="tex2html3336" href="the-query-likelihood-model-1.html"> <img width="26" height="24" align="BOTTOM" border="0" alt="up" src="http://nlp.stanford.edu/IR-book/html/icons/up.png" /></a> 
  <a name="tex2html3330" href="using-query-likelihood-language-models-in-ir-1.html"> <img width="63" height="24" align="BOTTOM" border="0" alt="previous" src="http://nlp.stanford.edu/IR-book/html/icons/prev.png" /></a> 
  <a name="tex2html3338" href="contents-1.html"> <img width="65" height="24" align="BOTTOM" border="0" alt="contents" src="http://nlp.stanford.edu/IR-book/html/icons/contents.png" /></a> 
  <a name="tex2html3340" href="index-1.html"> <img width="43" height="24" align="BOTTOM" border="0" alt="index" src="http://nlp.stanford.edu/IR-book/html/icons/index.png" /></a> 
  <br /> 
  <b> Next:</b> 
  <a name="tex2html3343" href="ponte-and-crofts-experiments-1.html">Ponte and Croft's Experiments</a> 
  <b> Up:</b> 
  <a name="tex2html3337" href="the-query-likelihood-model-1.html">The query likelihood model</a> 
  <b> Previous:</b> 
  <a name="tex2html3331" href="using-query-likelihood-language-models-in-ir-1.html">Using query likelihood language</a> &nbsp; 
  <b> <a name="tex2html3339" href="contents-1.html">Contents</a></b> &nbsp; 
  <b> <a name="tex2html3341" href="index-1.html">Index</a></b> 
  <!--End of Navigation Panel--> 
  <address> &copy; 2008 Cambridge University Press<br />This is an automatically generated page. In case of formatting errors you may want to look at the <a href="http://informationretrieval.org">PDF edition</a> of the book.<br /> 2009-04-07 </address>  
 </body>
</html>